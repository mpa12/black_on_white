import{_ as f,f as h,r as p,o as m,c,a as o,t as _,i as d,k as y,l as b,m as A,F as g,g as k,h as R,p as P,d as U,b as C}from"./app-c5fa08c9.js";import{m as l}from"./moment-with-locales-723ca905.js";import"./_commonjsHelpers-87174ba5.js";const x={name:"Comment",props:["comment","comments"],data(){return{canComment:!1,canDeleteComment:!1,childComments:null,parentComments:[],errors:[],replying:!1,isDeleted:!1,body:null}},mounted(){this.getChildComment(),this.checkCanComment(),this.checkCanDeleteComment()},methods:{checkCanComment(){this.canComment=!!localStorage.getItem("token")},checkCanDeleteComment(){this.canDeleteComment=this.comment.can_delete},getChildComment(){this.childComments=this.comments.filter(e=>e.parent_id===this.comment.id)},changeCreatedAt(e){e=new Date(e);const t=l.duration(l().diff(e));if(t.asMinutes()<60){let s=new Date().getTime()-e.getTime();return s=new Date(s).getMinutes(),s+" минут назад"}else return t.asHours()<24?l().subtract(t).format("HH часов назад"):t.asDays()<2?l().subtract(t).format("Вчера в HH:mm"):(l.locale("ru"),l(e).format("D MMMM в HH:mm YYYY"))},showReplyForm(){this.replying=!0},hideReplyForm(){this.replying=!1},reply(){let e=new FormData;e.append("body",this.body),e.append("article_id",this.$route.params.id),e.append("parent_id",this.comment.id),h.post("/api/comment",e,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(t=>{this.errors=[],this.body=null,this.childComments.push(t.data.success)}).catch(t=>{if(t.response.status===422){this.errors=[];let s=JSON.parse(t.request.responseText).errors;for(const i in s)this.errors[i]=s[i][0]}})},deleteComment(e){h.post("/api/comment/"+e,{_method:"delete"},{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(()=>{this.isDeleted=!0}).catch(console.error)}}},v=e=>(P("data-v-841d6ae2"),e=e(),U(),e),I={key:0,class:"comment mt-2"},w={class:"d-flex gap-2 align-items-baseline"},S={class:"m-0"},V={class:"m-0"},H={class:"flex-grow-1"},L=v(()=>o("label",{class:"form-label"},"Ответ",-1)),M={class:"d-flex flex-column justify-content-between align-items-end"},E=v(()=>o("button",{class:"btn btn-dark"},"Отправить",-1));function T(e,t,s,i,n,r){const u=p("comment",!0);return m(),c(g,null,[n.isDeleted?d("",!0):(m(),c("section",I,[o("div",w,[o("h6",S,_(s.comment.user.name),1),o("time",null,_(r.changeCreatedAt(s.comment.created_at)),1)]),o("p",V,_(s.comment.body),1),n.canComment?(m(),c("button",{key:0,type:"button",class:"reply-button",onClick:t[0]||(t[0]=(...a)=>r.showReplyForm&&r.showReplyForm(...a))})):d("",!0),n.canDeleteComment?(m(),c("button",{key:1,type:"button",class:"delete-button",onClick:t[1]||(t[1]=a=>r.deleteComment(s.comment.id))})):d("",!0),n.replying?(m(),c("form",{key:2,class:"d-flex gap-2",onSubmit:t[4]||(t[4]=y((...a)=>r.reply&&r.reply(...a),["prevent"]))},[o("div",H,[L,b(o("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>n.body=a),type:"text",class:"form-control"},null,512),[[A,n.body]])]),o("div",M,[o("button",{class:"reply-cancel",type:"button",onClick:t[3]||(t[3]=(...a)=>r.hideReplyForm&&r.hideReplyForm(...a))},"отмена"),E])],32)):d("",!0)])),o("div",null,[n.childComments?(m(!0),c(g,{key:0},k(n.childComments,a=>(m(),R(u,{comment:a,comments:s.comments},null,8,["comment","comments"]))),256)):d("",!0)])],64)}const F=f(x,[["render",T],["__scopeId","data-v-841d6ae2"]]);const B={name:"Comments",components:{Comment:F},props:["article_id"],data(){return{canComment:!1,hasComments:!1,comments:[],parentComments:[],body:null,errors:[]}},mounted(){this.loadComments()},methods:{checkCanComment(){this.canComment=!!localStorage.getItem("token")},checkHasComments(){this.hasComments=!!this.comments},getParentComments(){this.parentComments=this.comments.filter(e=>e.parent_id===null)},loadComments(){h.get(`/api/comment/${this.article_id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(e=>{this.comments=e.data.data,this.checkCanComment(),this.checkHasComments(),this.getParentComments()})},createComment(){let e=new FormData;e.append("body",this.body),e.append("article_id",this.article_id),h.post("/api/comment",e,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(t=>{this.errors=[],this.body=null,this.comments.push(t.data.success),this.getParentComments()}).catch(t=>{if(t.response.status===422){this.errors=[];let s=JSON.parse(t.request.responseText).errors;for(const i in s)this.errors[i]=s[i][0]}})}}},D=e=>(P("data-v-b20c408c"),e=e(),U(),e),Y={key:0,class:"comments-section mt-3"},$={class:"flex-grow-1"},z=D(()=>o("label",{class:"form-label"},"Комментарий",-1)),N=D(()=>o("button",{class:"btn btn-dark"},"Отправить",-1)),q={key:1,class:"alert alert-light text-center"};function J(e,t,s,i,n,r){const u=p("comment");return n.canComment||n.hasComments?(m(),c("section",Y,[n.canComment?(m(),c("form",{key:0,class:"d-flex align-items-end gap-2",onSubmit:t[1]||(t[1]=y((...a)=>r.createComment&&r.createComment(...a),["prevent"]))},[o("div",$,[z,b(o("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=a=>n.body=a)},null,512),[[A,n.body]])]),N],32)):d("",!0),n.hasComments?d("",!0):(m(),c("p",q,"Нет комментариев")),(m(!0),c(g,null,k(n.parentComments,a=>(m(),R(u,{comment:a,comments:n.comments},null,8,["comment","comments"]))),256))])):d("",!0)}const O=f(B,[["render",J],["__scopeId","data-v-b20c408c"]]);const j={name:"ArticleRating",props:["articleId"],data(){return{rating:0,isRated:!1}},mounted(){this.getRating(this.articleId)},methods:{getRating(e){h.get(`/api/rating/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(t=>{this.rating=t.data.rating,this.isRated=t.data.isRated})},getImageSrc(e){return e?"/images/heart-fill.svg":"/images/heart.svg"},getImageAlt(e){return e?"Понравилось":"Лайкнуть"},updateRating(e){if(!localStorage.getItem("token"))return;this.rating+=this.isRated?-1:1,this.isRated=!this.isRated;let t=new FormData;t.append("create_rating",this.isRated?1:0),t.append("article_id",e),h.post("/api/rating",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(s=>{console.log(s)}).catch(s=>{console.error(s)}),this.getRating(e)}}},G={class:"w-100 section mt-3"},K=["src","alt"];function Q(e,t,s,i,n,r){return m(),c("section",G,[o("span",{role:"button",class:"me-2",onClick:t[0]||(t[0]=u=>r.updateRating(this.articleId))},[o("img",{src:r.getImageSrc(n.isRated),alt:r.getImageAlt(n.isRated)},null,8,K)]),o("span",null,_(n.rating),1)])}const W=f(j,[["render",Q],["__scopeId","data-v-a5dd0077"]]);const X={name:"Article",components:{ArticleRating:W,Comments:O},data(){return{article:[],createdAt:""}},mounted(){this.loadArticle()},methods:{loadArticle(){h.get("/api/article/"+this.$route.params.id).then(e=>{this.article=e.data.data,this.changeCreatedAt(this.article.created_at)})},changeCreatedAt(e){const t=new Date(e);let s=l.duration(l().diff(t));if(s.asMinutes()<60){let i=new Date().getTime()-t.getTime();i=new Date(i).getMinutes(),this.createdAt=i+" минут назад"}else s.asHours()<24?this.createdAt=l().subtract(s).format("HH часов назад"):s.asDays()<2?this.createdAt=l().subtract(s).format("Вчера в HH:mm"):(l.locale("ru"),this.createdAt=l(t).format("D MMMM в HH:mm YYYY"))}}},Z={class:"article-main"},ee={class:"mb-2"},te={class:"fw-lighter"},se=o("br",null,null,-1),ne={class:"mt-2"},oe=["src","alt"],ae=["innerHTML"];function re(e,t,s,i,n,r){const u=p("article-rating"),a=p("comments");return m(),c(g,null,[o("section",Z,[o("h3",ee,_(n.article.title),1),o("span",te,_(n.createdAt),1),se,o("p",ne,_(n.article.description),1),o("img",{src:"/storage/"+n.article.photo,alt:n.article.title,class:"my-2 mx-auto d-block article-main-img"},null,8,oe),o("section",{class:"mt-2 content",innerHTML:n.article.text},null,8,ae)]),C(u,{"article-id":e.$route.params.id},null,8,["article-id"]),C(a,{article_id:e.$route.params.id},null,8,["article_id"])],64)}const le=f(X,[["render",re]]);export{le as default};
