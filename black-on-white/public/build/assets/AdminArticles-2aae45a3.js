import{_ as w,f as g,r as x,o as d,c,a as t,e as h,t as o,b as m,F as p,g as y,w as k,s as f,k as b,i as V,p as M,d as D}from"./app-4f927822.js";import{m as u}from"./moment-with-locales-723ca905.js";import{A as U}from"./ArticleSearch-9bd75550.js";import"./_commonjsHelpers-87174ba5.js";const C={name:"AdminArticles",components:{ArticleSearch:U},data(){return{articles:[],currentPage:1,loading:!1,totalPages:null,selectedFilters:[],text:"",deleteArticleInfo:[]}},computed:{pages(){const s=[],{currentPage:r,totalPages:P}=this;let l=Math.max(r-Math.floor(5/2),1),i=Math.min(l+5-1,P);i-l<5-1&&(l=Math.max(i-5+1,1));for(let _=l;_<=i;_++)s.push(_);return s}},mounted(){this.loadArticles(),window.addEventListener("search",function(e){this.selectedFilters=[...e.detail.selectedFilters],this.text=e.detail.text,this.articles=[],this.page=1,this.loadArticles()}.bind(this))},methods:{loadArticles(){this.loading=!0;let e={page:this.currentPage};this.text!==""&&(e.text=this.text),this.selectedFilters.length>0&&(e.article_type=this.selectedFilters.join(",")),g.get("/api/article",{params:e}).then(s=>{this.articles=s.data.data,this.totalPages=s.data.meta.last_page,this.loading=!1})},convertDate(e){e=new Date(e);const s=u.duration(u().diff(e));if(s.asMinutes()<60){let r=new Date().getTime()-e.getTime();return r=new Date(r).getMinutes(),r+" минут назад"}else return s.asHours()<24?u().subtract(s).format("HH часов назад"):s.asDays()<2?u().subtract(s).format("Вчера в HH:mm"):(u.locale("ru"),u(e).format("D MMMM в HH:mm YYYY"))},prevPage(){this.currentPage>1&&(this.currentPage--,this.loadArticles())},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadArticles())},goToPage(e){this.currentPage!==e&&(this.currentPage=e,this.loadArticles())},loadDeleteArticle(e){g.get("/api/article/"+e).then(s=>{this.deleteArticleInfo=s.data.data})},deleteArticle(e){g.delete("/api/article/"+e,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(s=>{this.loadArticles()})}}},n=e=>(M("data-v-c3cfec3b"),e=e(),D(),e),I={class:"modal fade",id:"deleteModal"},L={class:"modal-dialog modal-dialog-centered"},E={class:"modal-content"},F={class:"modal-header"},H={class:"modal-title fs-5"},R=n(()=>t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1)),S={class:"modal-body"},N={class:"modal-footer justify-content-start"},T=n(()=>t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Отмена",-1)),B=n(()=>t("div",{class:"title my-3"},[t("h1",null,"Управление новостями")],-1)),Y={class:"table-wrapper"},j={class:"table table-hover"},z=n(()=>t("thead",null,[t("tr",null,[t("th",null,"№"),t("th",null,"ID"),t("th",null,"Заголовок"),t("th",null,"Описание"),t("th",null,"Тип"),t("th",null,"Создано"),t("th",null,"Обновлено"),t("th")])],-1)),q=["title"],G=["title"],J={class:"dropdown"},K=n(()=>t("span",{type:"button","data-bs-toggle":"dropdown"},[t("img",{src:"/images/three-dots-vertical.svg",alt:"three-dots-vertical",type:"button","data-toggle":"dropdown"})],-1)),O={class:"dropdown-menu dropdown-menu-end"},Q=["onClick"],W={class:"pagination"},X=n(()=>t("span",{"aria-hidden":"true"},"«",-1)),Z=[X],$=["onClick"],tt=n(()=>t("span",{"aria-hidden":"true"},"»",-1)),et=[tt],st={key:0,class:"text-center"};function at(e,s,r,P,l,i){const _=x("article-search"),v=x("router-link");return d(),c(p,null,[t("div",I,[t("div",L,[t("div",E,[t("div",F,[t("h1",H,[h("Удаление новости "),t("span",null,"«"+o(l.deleteArticleInfo.title)+"»",1)]),R]),t("div",S,[h(" Вы уверенны, что хотите удалить новость "),t("span",null,"«"+o(l.deleteArticleInfo.title)+"»",1),h("? ")]),t("div",N,[T,t("button",{type:"button",class:"btn btn-danger",onClick:s[0]||(s[0]=a=>i.deleteArticle(l.deleteArticleInfo.id)),"data-bs-dismiss":"modal"},"Удалить")])])])]),B,m(_,{class:"mb-3"}),t("div",Y,[t("table",j,[z,t("tbody",null,[(d(!0),c(p,null,y(l.articles,(a,A)=>(d(),c("tr",null,[t("th",null,o(A+1),1),t("td",null,o(a.id),1),t("td",{class:"text-truncate user-select-none",title:a.title},[m(v,{to:"/article/"+a.id,class:"text-decoration-none"},{default:k(()=>[h(o(a.title),1)]),_:2},1032,["to"])],8,q),t("td",{class:"text-truncate",title:a.description},o(a.description),9,G),t("td",null,o(a.article_type.title),1),t("td",null,o(i.convertDate(a.created_at)),1),t("td",null,o(i.convertDate(a.updated_at)),1),t("td",null,[t("div",J,[K,t("ul",O,[t("li",null,[m(v,{class:"dropdown-item",to:"/admin/articles/update/"+a.id},{default:k(()=>[h("Редактировать")]),_:2},1032,["to"])]),t("li",null,[t("span",{onClick:lt=>i.loadDeleteArticle(a.id),class:"dropdown-item",type:"button","data-bs-toggle":"modal","data-bs-target":"#deleteModal"}," Удалить ",8,Q)])])])])]))),256))])]),t("nav",null,[t("ul",W,[t("li",{class:f(["page-item",{disabled:l.currentPage===1}])},[t("span",{class:"page-link","aria-label":"Previous",onClick:s[1]||(s[1]=b((...a)=>i.prevPage&&i.prevPage(...a),["prevent"]))},Z)],2),(d(!0),c(p,null,y(i.pages,a=>(d(),c("li",{class:f(["page-item",{active:a===l.currentPage}]),key:a},[t("span",{class:"page-link",onClick:b(A=>i.goToPage(a),["prevent"])},o(a),9,$)],2))),128)),t("li",{class:f(["page-item",{disabled:l.currentPage===l.totalPages}])},[t("span",{class:"page-link","aria-label":"Next",onClick:s[2]||(s[2]=b((...a)=>i.nextPage&&i.nextPage(...a),["prevent"]))},et)],2)])])]),l.loading?(d(),c("div",st,"Loading...")):V("",!0)],64)}const dt=w(C,[["render",at],["__scopeId","data-v-c3cfec3b"]]);export{dt as default};
