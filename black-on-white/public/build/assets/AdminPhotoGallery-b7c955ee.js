import{_ as u,f as g,o as n,c,a as e,k as b,F as _,g as f,i as p,p as y,d as v}from"./app-4f927822.js";const I={name:"AdminPhotoGallery",data(){return{images:[],page:1,totalPages:null,loading:!0,deleteSrc:null,deleteId:null,deleteIndex:null,photo:null}},mounted(){this.loadImages(),window.addEventListener("scroll",this.handleScroll)},destroyed(){window.removeEventListener("scroll",this.handleScroll)},methods:{openImage(t){this.images[t].show=!0,document.body.style.overflow="hidden"},closeImage(t){this.images[t].show=!1,document.body.style.overflow="auto"},loadImages(){this.loading=!0;let t={page:this.page};g.get("/api/photo-gallery",{params:t}).then(s=>{let l=s.data.data.map(h=>({src:h.photo,show:!1,id:h.id}));this.images=[...this.images,...l],this.totalPages=s.data.meta.last_page,this.loading=!1})},handleScroll(){this.loading||window.pageYOffset+window.innerHeight+200>=document.body.offsetHeight&&this.page<this.totalPages&&(this.page+=1,this.loadImages())},openDeleteImage(t){this.deleteSrc=this.images[t].src,this.deleteId=this.images[t].id,this.deleteIndex=t},deleteImage(t,s){g.delete(`/api/photo-gallery/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(l=>{this.images.splice(s,1),console.log(l)}).catch(l=>{console.log(l)})},create(){let t=new FormData;t.append("photo",this.photo),g.post("/api/photo-gallery",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(()=>{this.photo=null,this.images=[],this.page=1,this.totalPages=null,this.loading=!0,this.loadImages()}).catch(s=>{console.log(s)})},handlePhotoUpload(){this.photo=this.$refs.files.files[0]}}},r=t=>(y("data-v-ef905909"),t=t(),v(),t),P={class:"modal fade",id:"deleteModal"},w={class:"modal-dialog modal-dialog-centered"},k={class:"modal-content"},U=r(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Вы действительно хотите удалить изображение?"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Закрыть"})],-1)),C={class:"modal-body"},S=["src"],A={class:"modal-footer justify-content-start"},L=r(()=>e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть",-1)),E={class:"modal fade",id:"createModal"},V={class:"modal-dialog modal-dialog-centered"},R=r(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Добавление изображения"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Закрыть"})],-1)),B={class:"modal-body"},D=r(()=>e("div",{class:"modal-footer justify-content-start"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть"),e("button",{class:"btn btn-success","data-bs-dismiss":"modal"},"Добавить")],-1)),M=r(()=>e("div",{class:"title my-3 d-flex align-items-center gap-3"},[e("h1",null,"Управление фотогалереей"),e("span",{class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#createModal"},"Добавить фотографию")],-1)),x={class:"gallery"},F=["src"],G={class:"gallery-buttons d-flex gap-2"},j=["onClick"],z=["onClick"],H=["onClick"],N=["onClick","src"],O={key:0,class:"text-center"};function T(t,s,l,h,d,a){return n(),c(_,null,[e("div",P,[e("div",w,[e("div",k,[U,e("div",C,[e("img",{src:d.deleteSrc,class:"w-100 rounded-2",alt:"Фото"},null,8,S)]),e("div",A,[L,e("button",{onClick:s[0]||(s[0]=o=>a.deleteImage(d.deleteId,d.deleteIndex)),type:"button",class:"btn btn-danger","data-bs-dismiss":"modal"},"Удалить")])])])]),e("div",E,[e("div",V,[e("form",{class:"modal-content",onSubmit:s[2]||(s[2]=b((...o)=>a.create&&a.create(...o),["prevent"]))},[R,e("div",B,[e("input",{onChange:s[1]||(s[1]=(...o)=>a.handlePhotoUpload&&a.handlePhotoUpload(...o)),ref:"files",class:"form-control",type:"file",id:"photo"},null,544)]),D],32)])]),M,e("div",x,[(n(!0),c(_,null,f(d.images,(o,i)=>(n(),c("div",{class:"gallery-item",key:i},[e("img",{class:"gallery-image",src:"/storage/"+o.src,alt:"Фото"},null,8,F),e("div",G,[e("span",{class:"badge bg-primary",onClick:m=>a.openImage(i)},"Смотреть",8,j),e("span",{class:"badge bg-danger",onClick:m=>a.openDeleteImage(i),"data-bs-toggle":"modal","data-bs-target":"#deleteModal"},"Удалить",8,z)]),o.show?(n(),c("div",{key:0,onClick:m=>a.closeImage(i),class:"overlay"},[e("img",{onClick:m=>a.closeImage(i),src:"/storage/"+o.src,alt:"Фото"},null,8,N)],8,H)):p("",!0)]))),128))]),d.loading?(n(),c("div",O,"Loading...")):p("",!0)],64)}const q=u(I,[["render",T],["__scopeId","data-v-ef905909"]]);export{q as default};
