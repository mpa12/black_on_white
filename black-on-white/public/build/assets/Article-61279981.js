import{_ as g,f as h,r as u,o as i,c,a as s,t as d,i as l,k as f,l as y,m as b,F as p,g as k,h as R,p as v,d as x,b as C}from"./app-77659426.js";import{c as I}from"./ChangeDate-db5be761.js";import"./_commonjsHelpers-87174ba5.js";const D={name:"Comment",props:["comment","comments"],data(){return{canComment:!1,canDeleteComment:!1,childComments:null,parentComments:[],errors:[],replying:!1,isDeleted:!1,body:null}},mounted(){this.getChildComment(),this.checkCanComment(),this.checkCanDeleteComment()},methods:{changeDate:I,checkCanComment(){this.canComment=!!localStorage.getItem("token")},checkCanDeleteComment(){this.canDeleteComment=this.comment.can_delete},getChildComment(){const e=t=>t.parent_id===this.comment.id;this.childComments=this.comments.filter(e)},showReplyForm(){this.replying=!0},hideReplyForm(){this.replying=!1},reply(){let e=new FormData;e.append("body",this.body),e.append("article_id",this.$route.params.id),e.append("parent_id",this.comment.id);const t="/api/comment",r={headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")}`}};h.post(t,e,r).then(m=>{this.errors=[],this.body=null,this.childComments.push(m.data.success)}).catch(m=>{if(m.response.status!==422)return;this.errors=[];let n=JSON.parse(m.request.responseText).errors;for(const o in n)this.errors[o]=n[o][0]})},deleteComment(e){const t="/api/comment/"+e,r={_method:"delete"},m={headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")}`}};h.post(t,r,m).then(()=>{this.isDeleted=!0}).catch(console.error)}}},A=e=>(v("data-v-b6965a46"),e=e(),x(),e),w={key:0,class:"comment mt-2"},F={class:"d-flex gap-2 align-items-baseline"},P={class:"m-0"},B={class:"m-0"},U={class:"flex-grow-1"},T=A(()=>s("label",{class:"form-label"},"Ответ",-1)),V={class:"d-flex flex-column justify-content-between align-items-end"},L=A(()=>s("button",{class:"btn btn-dark"},"Отправить",-1));function $(e,t,r,m,n,o){const _=u("comment",!0);return i(),c(p,null,[n.isDeleted?l("",!0):(i(),c("section",w,[s("div",F,[s("h6",P,d(r.comment.user.name),1),s("time",null,d(o.changeDate(r.comment.created_at)),1)]),s("p",B,d(r.comment.body),1),n.canComment?(i(),c("button",{key:0,type:"button",class:"reply-button",onClick:t[0]||(t[0]=(...a)=>o.showReplyForm&&o.showReplyForm(...a))})):l("",!0),n.canDeleteComment?(i(),c("button",{key:1,type:"button",class:"delete-button",onClick:t[1]||(t[1]=a=>o.deleteComment(r.comment.id))})):l("",!0),n.replying?(i(),c("form",{key:2,class:"d-flex gap-2",onSubmit:t[4]||(t[4]=f((...a)=>o.reply&&o.reply(...a),["prevent"]))},[s("div",U,[T,y(s("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>n.body=a),type:"text",class:"form-control"},null,512),[[b,n.body]])]),s("div",V,[s("button",{class:"reply-cancel",type:"button",onClick:t[3]||(t[3]=(...a)=>o.hideReplyForm&&o.hideReplyForm(...a))},"отмена"),L])],32)):l("",!0)])),s("div",null,[n.childComments?(i(!0),c(p,{key:0},k(n.childComments,a=>(i(),R(_,{comment:a,comments:r.comments},null,8,["comment","comments"]))),256)):l("",!0)])],64)}const z=g(D,[["render",$],["__scopeId","data-v-b6965a46"]]);const E={name:"Comments",components:{Comment:z},props:["article_id"],data(){return{canComment:!1,hasComments:!1,comments:[],parentComments:[],body:null,errors:[]}},mounted(){this.loadComments()},methods:{checkCanComment(){this.canComment=!!localStorage.getItem("token")},checkHasComments(){this.hasComments=!!this.comments},getParentComments(){this.parentComments=this.comments.filter(e=>e.parent_id===null)},loadComments(){const e=`/api/comment/${this.article_id}`,t={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}};h.get(e,t).then(r=>{this.comments=r.data.data,this.checkCanComment(),this.checkHasComments(),this.getParentComments()})},createComment(){let e=new FormData;e.append("body",this.body),e.append("article_id",this.article_id);const t="/api/comment",r={headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")}`}};h.post(t,e,r).then(m=>{this.errors=[],this.body=null,this.comments.push(m.data.success),this.getParentComments()}).catch(m=>{if(m.response.status!==422)return;this.errors=[];let n=JSON.parse(m.request.responseText).errors;for(const o in n)this.errors[o]=n[o][0]})}}},S=e=>(v("data-v-02365606"),e=e(),x(),e),N={key:0,class:"comments-section mt-3"},H={class:"flex-grow-1"},M=S(()=>s("label",{class:"form-label"},"Комментарий",-1)),q=S(()=>s("button",{class:"btn btn-dark"},"Отправить",-1)),J={key:1,class:"alert alert-light text-center"};function O(e,t,r,m,n,o){const _=u("comment");return n.canComment||n.hasComments?(i(),c("section",N,[n.canComment?(i(),c("form",{key:0,class:"d-flex align-items-end gap-2",onSubmit:t[1]||(t[1]=f((...a)=>o.createComment&&o.createComment(...a),["prevent"]))},[s("div",H,[M,y(s("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=a=>n.body=a)},null,512),[[b,n.body]])]),q],32)):l("",!0),n.hasComments?l("",!0):(i(),c("p",J,"Нет комментариев")),(i(!0),c(p,null,k(n.parentComments,a=>(i(),R(_,{comment:a,comments:n.comments},null,8,["comment","comments"]))),256))])):l("",!0)}const j=g(E,[["render",O],["__scopeId","data-v-02365606"]]);const G={name:"ArticleRating",props:["articleId"],data(){return{rating:0,isRated:!1}},mounted(){this.getRating(this.articleId)},methods:{getRating(e){h.get(`/api/rating/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(this.setRating).catch(console.error)},getImageSrc(e){return e?"/images/heart-fill.svg":"/images/heart.svg"},getImageAlt(e){return e?"Понравилось":"Лайкнуть"},updateRating(e){if(!localStorage.getItem("token"))return;this.rating+=this.isRated?-1:1,this.isRated=!this.isRated;let t=new FormData;t.append("create_rating",this.isRated?1:0),t.append("article_id",e),h.post("/api/rating",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(this.setRating).catch(console.error)},setRating(e){this.rating=e.data.rating,this.isRated=e.data.isRated}}},K={class:"w-100 section mt-3"},Q=["src","alt"];function W(e,t,r,m,n,o){return i(),c("section",K,[s("span",{role:"button",class:"me-2",onClick:t[0]||(t[0]=_=>o.updateRating(this.articleId))},[s("img",{src:o.getImageSrc(n.isRated),alt:o.getImageAlt(n.isRated)},null,8,Q)]),s("span",null,d(n.rating),1)])}const X=g(G,[["render",W],["__scopeId","data-v-66c2767e"]]);const Y={name:"Article",components:{ArticleRating:X,Comments:j},data(){return{article:[]}},mounted(){this.loadArticle()},methods:{changeDate:I,loadArticle(){const e="/api/article/"+this.$route.params.id;h.get(e).then(t=>{this.article=t.data.data})}}},Z={class:"article-main"},ee={class:"mb-2"},te={class:"fw-lighter"},ne=s("br",null,null,-1),se={class:"mt-2"},oe=["src","alt"],ae=["innerHTML"];function re(e,t,r,m,n,o){const _=u("article-rating"),a=u("comments");return i(),c(p,null,[s("section",Z,[s("h3",ee,d(n.article.title),1),s("span",te,d(o.changeDate(n.article.created_at)),1),ne,s("p",se,d(n.article.description),1),s("img",{src:"/storage/"+n.article.photo,alt:n.article.title,class:"my-2 mx-auto d-block article-main-img"},null,8,oe),s("section",{class:"mt-2 content",innerHTML:n.article.text},null,8,ae)]),C(_,{"article-id":e.$route.params.id},null,8,["article-id"]),C(a,{article_id:e.$route.params.id},null,8,["article_id"])],64)}const le=g(Y,[["render",re]]);export{le as default};
