import{_ as k,U as w,f as C,r as P,o as d,c,a as t,e as h,t as i,b as g,F as p,g as A,w as x,s as m,k as b,i as I,p as V,d as D}from"./app-bded94c7.js";import{A as M}from"./ArticleSearch-6ed6026c.js";import{c as S}from"./ChangeDate-db5be761.js";import{A as y}from"./ArticleService-0e254c19.js";import"./_commonjsHelpers-87174ba5.js";const F={name:"AdminArticles",components:{ArticleSearch:M},data(){return{articles:[],currentPage:1,loading:!1,totalPages:null,selectedFilters:[],text:"",deleteArticleInfo:[]}},computed:{pages(){const o=[],{currentPage:u,totalPages:_}=this;let l=Math.max(u-Math.floor(5/2),1),a=Math.min(l+5-1,_);a-l<5-1&&(l=Math.max(a-5+1,1));for(let r=l;r<=a;r++)o.push(r);return o}},mounted(){this.loadArticles(),window.addEventListener("search",function(s){this.selectedFilters=[...s.detail.selectedFilters],this.text=s.detail.text,this.articles=[],this.page=1,this.loadArticles()}.bind(this))},methods:{changeDate:S,async loadArticles(){this.loading=!0;const s=await y.index(this.currentPage,this.text,this.selectedFilters,[]);this.articles=s.articles,this.totalPages=s.totalPages,this.loading=!1},prevPage(){this.currentPage>1&&(this.currentPage--,this.loadArticles())},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadArticles())},goToPage(s){this.currentPage!==s&&(this.currentPage=s,this.loadArticles())},async loadDeleteArticle(s){this.deleteArticleInfo=await y.show(s)},deleteArticle(s){const o="/api/article/"+s,u={_method:"delete"},_={headers:{Authorization:w.getAuthorizationString()}};C.post(o,u,_).then(this.loadArticles).catch(console.error)}}},n=s=>(V("data-v-9232dc18"),s=s(),D(),s),N={class:"modal fade",id:"deleteModal"},z={class:"modal-dialog modal-dialog-centered"},B={class:"modal-content"},L={class:"modal-header"},T={class:"modal-title fs-5"},E=n(()=>t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1)),U={class:"modal-body"},j={class:"modal-footer justify-content-start"},q=n(()=>t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Отмена",-1)),G=n(()=>t("div",{class:"title my-3"},[t("h1",null,"Управление новостями")],-1)),H={class:"table-wrapper"},J={class:"table table-hover"},K=n(()=>t("thead",null,[t("tr",null,[t("th",null,"№"),t("th",null,"ID"),t("th",null,"Заголовок"),t("th",null,"Описание"),t("th",null,"Тип"),t("th",null,"Создано"),t("th",null,"Обновлено"),t("th")])],-1)),O=["title"],Q=["title"],R={class:"dropdown"},W=n(()=>t("span",{type:"button","data-bs-toggle":"dropdown"},[t("img",{src:"/images/three-dots-vertical.svg",alt:"three-dots-vertical",type:"button","data-toggle":"dropdown"})],-1)),X={class:"dropdown-menu dropdown-menu-end"},Y=["onClick"],Z={class:"pagination"},$=n(()=>t("span",{"aria-hidden":"true"},"«",-1)),tt=[$],et=["onClick"],st=n(()=>t("span",{"aria-hidden":"true"},"»",-1)),lt=[st],at={key:0,class:"text-center"};function ot(s,o,u,_,l,a){const r=P("article-search"),f=P("router-link");return d(),c(p,null,[t("div",N,[t("div",z,[t("div",B,[t("div",L,[t("h1",T,[h("Удаление новости "),t("span",null,"«"+i(l.deleteArticleInfo.title)+"»",1)]),E]),t("div",U,[h(" Вы уверенны, что хотите удалить новость "),t("span",null,"«"+i(l.deleteArticleInfo.title)+"»",1),h("? ")]),t("div",j,[q,t("button",{type:"button",class:"btn btn-danger",onClick:o[0]||(o[0]=e=>a.deleteArticle(l.deleteArticleInfo.id)),"data-bs-dismiss":"modal"},"Удалить")])])])]),G,g(r,{class:"mb-3"}),t("div",H,[t("table",J,[K,t("tbody",null,[(d(!0),c(p,null,A(l.articles,(e,v)=>(d(),c("tr",null,[t("th",null,i(v+1),1),t("td",null,i(e.id),1),t("td",{class:"text-truncate user-select-none",title:e.title},[g(f,{to:"/article/"+e.id,class:"text-decoration-none"},{default:x(()=>[h(i(e.title),1)]),_:2},1032,["to"])],8,O),t("td",{class:"text-truncate",title:e.description},i(e.description),9,Q),t("td",null,i(e.article_type.title),1),t("td",null,i(a.changeDate(e.created_at)),1),t("td",null,i(a.changeDate(e.updated_at)),1),t("td",null,[t("div",R,[W,t("ul",X,[t("li",null,[g(f,{class:"dropdown-item",to:"/admin/articles/update/"+e.id},{default:x(()=>[h("Редактировать")]),_:2},1032,["to"])]),t("li",null,[t("span",{onClick:it=>a.loadDeleteArticle(e.id),class:"dropdown-item",type:"button","data-bs-toggle":"modal","data-bs-target":"#deleteModal"}," Удалить ",8,Y)])])])])]))),256))])]),t("nav",null,[t("ul",Z,[t("li",{class:m(["page-item",{disabled:l.currentPage===1}])},[t("span",{class:"page-link","aria-label":"Previous",onClick:o[1]||(o[1]=b((...e)=>a.prevPage&&a.prevPage(...e),["prevent"]))},tt)],2),(d(!0),c(p,null,A(a.pages,e=>(d(),c("li",{class:m(["page-item",{active:e===l.currentPage}]),key:e},[t("span",{class:"page-link",onClick:b(v=>a.goToPage(e),["prevent"])},i(e),9,et)],2))),128)),t("li",{class:m(["page-item",{disabled:l.currentPage===l.totalPages}])},[t("span",{class:"page-link","aria-label":"Next",onClick:o[2]||(o[2]=b((...e)=>a.nextPage&&a.nextPage(...e),["prevent"]))},lt)],2)])])]),l.loading?(d(),c("div",at,"Loading...")):I("",!0)],64)}const ut=k(F,[["render",ot],["__scopeId","data-v-9232dc18"]]);export{ut as default};
