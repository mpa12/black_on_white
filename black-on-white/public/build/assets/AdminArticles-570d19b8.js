import{_ as y,f as _,r as A,o as d,c as r,a as t,e as h,t as o,b as u,F as g,g as x,w as k,s as p,k as m,i as V,p as w,d as U}from"./app-e9fbd619.js";import{A as C}from"./ArticleSearch-bbaa1cb1.js";import{c as I}from"./ChangeDate-db5be761.js";import"./_commonjsHelpers-87174ba5.js";const L={name:"AdminArticles",components:{ArticleSearch:C},data(){return{articles:[],currentPage:1,loading:!1,totalPages:null,selectedFilters:[],text:"",deleteArticleInfo:[]}},computed:{pages(){const a=[],{currentPage:P,totalPages:b}=this;let l=Math.max(P-Math.floor(5/2),1),i=Math.min(l+5-1,b);i-l<5-1&&(l=Math.max(i-5+1,1));for(let c=l;c<=i;c++)a.push(c);return a}},mounted(){this.loadArticles(),window.addEventListener("search",function(s){this.selectedFilters=[...s.detail.selectedFilters],this.text=s.detail.text,this.articles=[],this.page=1,this.loadArticles()}.bind(this))},methods:{changeDate:I,loadArticles(){this.loading=!0;let s={page:this.currentPage};this.text!==""&&(s.text=this.text),this.selectedFilters.length>0&&(s.article_type=this.selectedFilters.join(",")),_.get("/api/article",{params:s}).then(a=>{this.articles=a.data.data,this.totalPages=a.data.meta.last_page,this.loading=!1})},prevPage(){this.currentPage>1&&(this.currentPage--,this.loadArticles())},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadArticles())},goToPage(s){this.currentPage!==s&&(this.currentPage=s,this.loadArticles())},loadDeleteArticle(s){_.get("/api/article/"+s).then(a=>{this.deleteArticleInfo=a.data.data})},deleteArticle(s){_.post("/api/article/"+s,{_method:"delete"},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(this.loadArticles).catch(console.error)}}},n=s=>(w("data-v-1ae3fe99"),s=s(),U(),s),E={class:"modal fade",id:"deleteModal"},D={class:"modal-dialog modal-dialog-centered"},F={class:"modal-content"},M={class:"modal-header"},R={class:"modal-title fs-5"},S=n(()=>t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1)),N={class:"modal-body"},B={class:"modal-footer justify-content-start"},T=n(()=>t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Отмена",-1)),j=n(()=>t("div",{class:"title my-3"},[t("h1",null,"Управление новостями")],-1)),z={class:"table-wrapper"},q={class:"table table-hover"},G=n(()=>t("thead",null,[t("tr",null,[t("th",null,"№"),t("th",null,"ID"),t("th",null,"Заголовок"),t("th",null,"Описание"),t("th",null,"Тип"),t("th",null,"Создано"),t("th",null,"Обновлено"),t("th")])],-1)),H=["title"],J=["title"],K={class:"dropdown"},O=n(()=>t("span",{type:"button","data-bs-toggle":"dropdown"},[t("img",{src:"/images/three-dots-vertical.svg",alt:"three-dots-vertical",type:"button","data-toggle":"dropdown"})],-1)),Q={class:"dropdown-menu dropdown-menu-end"},W=["onClick"],X={class:"pagination"},Y=n(()=>t("span",{"aria-hidden":"true"},"«",-1)),Z=[Y],$=["onClick"],tt=n(()=>t("span",{"aria-hidden":"true"},"»",-1)),et=[tt],st={key:0,class:"text-center"};function at(s,a,P,b,l,i){const c=A("article-search"),f=A("router-link");return d(),r(g,null,[t("div",E,[t("div",D,[t("div",F,[t("div",M,[t("h1",R,[h("Удаление новости "),t("span",null,"«"+o(l.deleteArticleInfo.title)+"»",1)]),S]),t("div",N,[h(" Вы уверенны, что хотите удалить новость "),t("span",null,"«"+o(l.deleteArticleInfo.title)+"»",1),h("? ")]),t("div",B,[T,t("button",{type:"button",class:"btn btn-danger",onClick:a[0]||(a[0]=e=>i.deleteArticle(l.deleteArticleInfo.id)),"data-bs-dismiss":"modal"},"Удалить")])])])]),j,u(c,{class:"mb-3"}),t("div",z,[t("table",q,[G,t("tbody",null,[(d(!0),r(g,null,x(l.articles,(e,v)=>(d(),r("tr",null,[t("th",null,o(v+1),1),t("td",null,o(e.id),1),t("td",{class:"text-truncate user-select-none",title:e.title},[u(f,{to:"/article/"+e.id,class:"text-decoration-none"},{default:k(()=>[h(o(e.title),1)]),_:2},1032,["to"])],8,H),t("td",{class:"text-truncate",title:e.description},o(e.description),9,J),t("td",null,o(e.article_type.title),1),t("td",null,o(i.changeDate(e.created_at)),1),t("td",null,o(i.changeDate(e.updated_at)),1),t("td",null,[t("div",K,[O,t("ul",Q,[t("li",null,[u(f,{class:"dropdown-item",to:"/admin/articles/update/"+e.id},{default:k(()=>[h("Редактировать")]),_:2},1032,["to"])]),t("li",null,[t("span",{onClick:lt=>i.loadDeleteArticle(e.id),class:"dropdown-item",type:"button","data-bs-toggle":"modal","data-bs-target":"#deleteModal"}," Удалить ",8,W)])])])])]))),256))])]),t("nav",null,[t("ul",X,[t("li",{class:p(["page-item",{disabled:l.currentPage===1}])},[t("span",{class:"page-link","aria-label":"Previous",onClick:a[1]||(a[1]=m((...e)=>i.prevPage&&i.prevPage(...e),["prevent"]))},Z)],2),(d(!0),r(g,null,x(i.pages,e=>(d(),r("li",{class:p(["page-item",{active:e===l.currentPage}]),key:e},[t("span",{class:"page-link",onClick:m(v=>i.goToPage(e),["prevent"])},o(e),9,$)],2))),128)),t("li",{class:p(["page-item",{disabled:l.currentPage===l.totalPages}])},[t("span",{class:"page-link","aria-label":"Next",onClick:a[2]||(a[2]=m((...e)=>i.nextPage&&i.nextPage(...e),["prevent"]))},et)],2)])])]),l.loading?(d(),r("div",st,"Loading...")):V("",!0)],64)}const rt=y(L,[["render",at],["__scopeId","data-v-1ae3fe99"]]);export{rt as default};
