import{_ as M,f as m,r as k,o as r,c,a as e,e as _,t as n,F as p,g as v,b as x,w as y,s as h,k as P,i as V,p as w,d as I}from"./app-4f927822.js";import{m as g}from"./moment-with-locales-723ca905.js";import"./_commonjsHelpers-87174ba5.js";const A={name:"AdminMessages",data(){return{messages:[],currentPage:1,loading:!1,totalPages:null,deleteMessageInfo:[]}},computed:{pages(){const a=[],{currentPage:d,totalPages:b}=this;let l=Math.max(d-Math.floor(5/2),1),o=Math.min(l+5-1,b);o-l<5-1&&(l=Math.max(o-5+1,1));for(let u=l;u<=o;u++)a.push(u);return a}},mounted(){this.loadMessages()},methods:{loadMessages(){this.loading=!0,m.get("/api/message?page="+this.currentPage,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(s=>{this.messages=s.data.data,this.totalPages=s.data.meta.last_page,this.loading=!1})},convertDate(s){s=new Date(s);const a=g.duration(g().diff(s));if(a.asMinutes()<60){let d=new Date().getTime()-s.getTime();return d=new Date(d).getMinutes(),d+" минут назад"}else return a.asHours()<24?g().subtract(a).format("HH часов назад"):a.asDays()<2?g().subtract(a).format("Вчера в HH:mm"):(g.locale("ru"),g(s).format("D MMMM в HH:mm YYYY"))},prevPage(){this.currentPage>1&&(this.currentPage--,this.loadMessages())},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadMessages())},goToPage(s){this.currentPage!==s&&(this.currentPage=s,this.loadMessages())},loadDeleteMessage(s){m.get("/api/message/"+s,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(a=>{this.deleteMessageInfo=a.data.data})},deleteMessage(s){m.delete("/api/message/"+s,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(()=>{this.loadMessages()})}}},i=s=>(w("data-v-e342d42d"),s=s(),I(),s),U={class:"modal fade",id:"deleteModal"},C={class:"modal-dialog modal-dialog-centered"},D={class:"modal-content"},E={class:"modal-header"},L={class:"modal-title fs-5"},H=i(()=>e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1)),S={class:"modal-body"},B={class:"modal-footer justify-content-start"},R=i(()=>e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Отмена",-1)),N=i(()=>e("div",{class:"title my-3"},[e("h1",null,"Управление сообщениями")],-1)),T={class:"table-wrapper"},z={class:"table table-hover"},Y=i(()=>e("thead",null,[e("tr",null,[e("th",null,"№"),e("th",null,"ID"),e("th",null,"Имя"),e("th",null,"Телефон"),e("th",null,"E-mail"),e("th",null,"Создано"),e("th",null,"Прочитано"),e("th")])],-1)),F=["title"],j=["title"],q=["title"],G={class:"dropdown"},J=i(()=>e("span",{type:"button","data-bs-toggle":"dropdown"},[e("img",{src:"/images/three-dots-vertical.svg",alt:"three-dots-vertical",type:"button","data-toggle":"dropdown"})],-1)),K={class:"dropdown-menu dropdown-menu-end"},O=["onClick"],Q={class:"pagination"},W=i(()=>e("span",{"aria-hidden":"true"},"«",-1)),X=[W],Z=["onClick"],$=i(()=>e("span",{"aria-hidden":"true"},"»",-1)),ee=[$],te={key:0,class:"text-center"};function se(s,a,d,b,l,o){const u=k("router-link");return r(),c(p,null,[e("div",U,[e("div",C,[e("div",D,[e("div",E,[e("h1",L,[_("Удаление сообщения пользователя "),e("span",null,"«"+n(l.deleteMessageInfo.name)+"»",1)]),H]),e("div",S,[_(" Вы уверенны, что хотите удалить сообщение пользователя "),e("span",null,"«"+n(l.deleteMessageInfo.name)+"»",1),_("? ")]),e("div",B,[R,e("button",{type:"button",class:"btn btn-danger",onClick:a[0]||(a[0]=t=>o.deleteMessage(l.deleteMessageInfo.id)),"data-bs-dismiss":"modal"},"Удалить")])])])]),N,e("div",T,[e("table",z,[Y,e("tbody",null,[(r(!0),c(p,null,v(l.messages,(t,f)=>(r(),c("tr",null,[e("th",null,n(f+1),1),e("td",null,n(t.id),1),e("td",{class:"text-truncate user-select-none",title:t.name},[x(u,{to:"/admin/messages/"+t.id,class:"text-decoration-none"},{default:y(()=>[_(n(t.name),1)]),_:2},1032,["to"])],8,F),e("td",{class:"text-truncate",title:t.phone},n(t.phone),9,j),e("td",{class:"text-truncate",title:t.email},n(t.email),9,q),e("td",null,n(o.convertDate(t.created_at)),1),e("td",null,[e("span",{class:h(t.is_read?"badge bg-light text-dark":"badge bg-info text-dark")},n(t.is_read?"Прочитано":"Не прочитано"),3)]),e("td",null,[e("div",G,[J,e("ul",K,[e("li",null,[e("span",{onClick:ae=>o.loadDeleteMessage(t.id),class:"dropdown-item",type:"button","data-bs-toggle":"modal","data-bs-target":"#deleteModal"}," Удалить ",8,O)])])])])]))),256))])]),e("nav",null,[e("ul",Q,[e("li",{class:h(["page-item",{disabled:l.currentPage===1}])},[e("span",{class:"page-link","aria-label":"Previous",onClick:a[1]||(a[1]=P((...t)=>o.prevPage&&o.prevPage(...t),["prevent"]))},X)],2),(r(!0),c(p,null,v(o.pages,t=>(r(),c("li",{class:h(["page-item",{active:t===l.currentPage}]),key:t},[e("span",{class:"page-link",onClick:P(f=>o.goToPage(t),["prevent"])},n(t),9,Z)],2))),128)),e("li",{class:h(["page-item",{disabled:l.currentPage===l.totalPages}])},[e("span",{class:"page-link","aria-label":"Next",onClick:a[2]||(a[2]=P((...t)=>o.nextPage&&o.nextPage(...t),["prevent"]))},ee)],2)])])]),l.loading?(r(),c("div",te,"Loading...")):V("",!0)],64)}const ie=M(A,[["render",se],["__scopeId","data-v-e342d42d"]]);export{ie as default};
