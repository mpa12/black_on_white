import{_ as C,U as d,f as u,r as p,o as m,c,a as s,t as h,i as l,k as y,l as b,m as k,F as g,g as R,h as v,p as A,d as x,b as f}from"./app-e9fbd619.js";import{c as D}from"./ChangeDate-db5be761.js";import"./_commonjsHelpers-87174ba5.js";const w={name:"Comment",props:["comment","comments"],data(){return{canComment:!1,canDeleteComment:!1,childComments:null,parentComments:[],errors:[],replying:!1,isDeleted:!1,body:null}},mounted(){this.getChildComment(),this.checkCanComment(),this.checkCanDeleteComment()},methods:{changeDate:D,checkCanComment(){this.canComment=!!localStorage.getItem("token")},checkCanDeleteComment(){this.canDeleteComment=this.comment.can_delete},getChildComment(){const t=e=>e.parent_id===this.comment.id;this.childComments=this.comments.filter(t)},showReplyForm(){this.replying=!0},hideReplyForm(){this.replying=!1},reply(){let t=new FormData;t.append("body",this.body),t.append("article_id",this.$route.params.id),t.append("parent_id",this.comment.id);const e="/api/comment",i={headers:{"Content-Type":"multipart/form-data",Authorization:d.getAuthorizationString()}};u.post(e,t,i).then(a=>{this.errors=[],this.body=null,this.childComments.push(a.data.success)}).catch(a=>{if(a.response.status!==422)return;this.errors=[];let n=JSON.parse(a.request.responseText).errors;for(const o in n)this.errors[o]=n[o][0]})},deleteComment(t){const e="/api/comment/"+t,i={_method:"delete"},a={headers:{"Content-Type":"multipart/form-data",Authorization:d.getAuthorizationString()}};u.post(e,i,a).then(()=>{this.isDeleted=!0}).catch(console.error)}}},S=t=>(A("data-v-f2700b20"),t=t(),x(),t),z={key:0,class:"comment mt-2"},U={class:"d-flex gap-2 align-items-baseline"},F={class:"m-0"},P={class:"m-0"},T={class:"flex-grow-1"},V=S(()=>s("label",{class:"form-label"},"Ответ",-1)),L={class:"d-flex flex-column justify-content-between align-items-end"},E=S(()=>s("button",{class:"btn btn-dark"},"Отправить",-1));function N(t,e,i,a,n,o){const _=p("comment",!0);return m(),c(g,null,[n.isDeleted?l("",!0):(m(),c("section",z,[s("div",U,[s("h6",F,h(i.comment.user.name),1),s("time",null,h(o.changeDate(i.comment.created_at)),1)]),s("p",P,h(i.comment.body),1),n.canComment?(m(),c("button",{key:0,type:"button",class:"reply-button",onClick:e[0]||(e[0]=(...r)=>o.showReplyForm&&o.showReplyForm(...r))})):l("",!0),n.canDeleteComment?(m(),c("button",{key:1,type:"button",class:"delete-button",onClick:e[1]||(e[1]=r=>o.deleteComment(i.comment.id))})):l("",!0),n.replying?(m(),c("form",{key:2,class:"d-flex gap-2",onSubmit:e[4]||(e[4]=y((...r)=>o.reply&&o.reply(...r),["prevent"]))},[s("div",T,[V,b(s("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>n.body=r),type:"text",class:"form-control"},null,512),[[k,n.body]])]),s("div",L,[s("button",{class:"reply-cancel",type:"button",onClick:e[3]||(e[3]=(...r)=>o.hideReplyForm&&o.hideReplyForm(...r))},"отмена"),E])],32)):l("",!0)])),s("div",null,[n.childComments?(m(!0),c(g,{key:0},R(n.childComments,r=>(m(),v(_,{comment:r,comments:i.comments},null,8,["comment","comments"]))),256)):l("",!0)])],64)}const B=C(w,[["render",N],["__scopeId","data-v-f2700b20"]]);const H={name:"Comments",components:{Comment:B},props:["article_id"],data(){return{canComment:!1,hasComments:!1,comments:[],parentComments:[],body:null,errors:[]}},mounted(){this.loadComments()},methods:{checkCanComment(){this.canComment=!!localStorage.getItem("token")},checkHasComments(){this.hasComments=!!this.comments},getParentComments(){this.parentComments=this.comments.filter(t=>t.parent_id===null)},loadComments(){const t=`/api/comment/${this.article_id}`,e={headers:{Authorization:d.getAuthorizationString()}};u.get(t,e).then(i=>{this.comments=i.data.data,this.checkCanComment(),this.checkHasComments(),this.getParentComments()})},createComment(){let t=new FormData;t.append("body",this.body),t.append("article_id",this.article_id);const e="/api/comment",i={headers:{"Content-Type":"multipart/form-data",Authorization:d.getAuthorizationString()}};u.post(e,t,i).then(a=>{this.errors=[],this.body=null,this.comments.push(a.data.success),this.getParentComments()}).catch(a=>{if(a.response.status!==422)return;this.errors=[];let n=JSON.parse(a.request.responseText).errors;for(const o in n)this.errors[o]=n[o][0]})}}},I=t=>(A("data-v-90078c6b"),t=t(),x(),t),M={key:0,class:"comments-section mt-3"},q={class:"flex-grow-1"},J=I(()=>s("label",{class:"form-label"},"Комментарий",-1)),O=I(()=>s("button",{class:"btn btn-dark"},"Отправить",-1)),j={key:1,class:"alert alert-light text-center"};function G(t,e,i,a,n,o){const _=p("comment");return n.canComment||n.hasComments?(m(),c("section",M,[n.canComment?(m(),c("form",{key:0,class:"d-flex align-items-end gap-2",onSubmit:e[1]||(e[1]=y((...r)=>o.createComment&&o.createComment(...r),["prevent"]))},[s("div",q,[J,b(s("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=r=>n.body=r)},null,512),[[k,n.body]])]),O],32)):l("",!0),n.hasComments?l("",!0):(m(),c("p",j,"Нет комментариев")),(m(!0),c(g,null,R(n.parentComments,r=>(m(),v(_,{comment:r,comments:n.comments},null,8,["comment","comments"]))),256))])):l("",!0)}const $=C(H,[["render",G],["__scopeId","data-v-90078c6b"]]);const K={name:"ArticleRating",props:["articleId"],data(){return{rating:0,isRated:!1}},mounted(){this.getRating(this.articleId)},methods:{getRating(t){u.get(`/api/rating/${t}`,{headers:{Authorization:d.getAuthorizationString()}}).then(this.setRating).catch(console.error)},getImageSrc(t){return t?"/images/heart-fill.svg":"/images/heart.svg"},getImageAlt(t){return t?"Понравилось":"Лайкнуть"},updateRating(t){if(d.isGuest())return;this.rating+=this.isRated?-1:1,this.isRated=!this.isRated;let e=new FormData;e.append("create_rating",this.isRated?1:0),e.append("article_id",t),u.post("/api/rating",e,{headers:{"Content-Type":"multipart/form-data",Authorization:d.getAuthorizationString()}}).then(this.setRating).catch(console.error)},setRating(t){this.rating=t.data.rating,this.isRated=t.data.isRated}}},Q={class:"w-100 section mt-3"},W=["src","alt"];function X(t,e,i,a,n,o){return m(),c("section",Q,[s("span",{role:"button",class:"me-2",onClick:e[0]||(e[0]=_=>o.updateRating(this.articleId))},[s("img",{src:o.getImageSrc(n.isRated),alt:o.getImageAlt(n.isRated)},null,8,W)]),s("span",null,h(n.rating),1)])}const Y=C(K,[["render",X],["__scopeId","data-v-9ad42180"]]);const Z={name:"Article",components:{ArticleRating:Y,Comments:$},data(){return{article:[]}},mounted(){this.loadArticle()},methods:{changeDate:D,loadArticle(){const t="/api/article/"+this.$route.params.id;u.get(t).then(e=>{this.article=e.data.data})}}},tt={class:"article-main"},et={class:"mb-2"},nt={class:"fw-lighter"},st=s("br",null,null,-1),ot={class:"mt-2"},rt=["src","alt"],it=["innerHTML"];function at(t,e,i,a,n,o){const _=p("article-rating"),r=p("comments");return m(),c(g,null,[s("section",tt,[s("h3",et,h(n.article.title),1),s("span",nt,h(o.changeDate(n.article.created_at)),1),st,s("p",ot,h(n.article.description),1),s("img",{src:"/storage/"+n.article.photo,alt:n.article.title,class:"my-2 mx-auto d-block article-main-img"},null,8,rt),s("section",{class:"mt-2 content",innerHTML:n.article.text},null,8,it)]),f(_,{"article-id":t.$route.params.id},null,8,["article-id"]),f(r,{article_id:t.$route.params.id},null,8,["article_id"])],64)}const dt=C(Z,[["render",at]]);export{dt as default};
