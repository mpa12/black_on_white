import{_ as u,f as m,o as i,c as n,a as e,k as b,F as _,g as f,i as p,p as y,d as v}from"./app-38c7d57f.js";const I={name:"AdminPhotoGallery",data(){return{images:[],page:1,totalPages:null,loading:!0,deleteSrc:null,deleteId:null,deleteIndex:null,photo:null}},mounted(){this.loadImages(),window.addEventListener("scroll",this.handleScroll)},destroyed(){window.removeEventListener("scroll",this.handleScroll)},methods:{openImage(t){this.images[t].show=!0,document.body.style.overflow="hidden"},closeImage(t){this.images[t].show=!1,document.body.style.overflow="auto"},loadImages(){this.loading=!0;let t={page:this.page};m.get("/api/photo-gallery",{params:t}).then(s=>{let g=s.data.data.map(r=>({src:r.photo,show:!1,id:r.id}));this.images=[...this.images,...g],this.totalPages=s.data.meta.last_page,this.loading=!1})},handleScroll(){if(!this.loading&&window.pageYOffset+window.innerHeight+200>=document.body.offsetHeight){if(!(this.page<this.totalPages))return;this.page++,this.loadImages()}},openDeleteImage(t){this.deleteSrc=this.images[t].src,this.deleteId=this.images[t].id,this.deleteIndex=t},deleteImage(t,s){m.post(`/api/photo-gallery/${t}`,{_method:"delete"},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(()=>{this.images.splice(s,1)}).catch(console.error)},create(){let t=new FormData;t.append("photo",this.photo),m.post("/api/photo-gallery",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(()=>{this.photo=null,this.images=[],this.page=1,this.totalPages=null,this.loading=!0,this.loadImages()}).catch(console.error)},handlePhotoUpload(){this.photo=this.$refs.files.files[0]}}},c=t=>(y("data-v-f1cfa486"),t=t(),v(),t),P={class:"modal fade",id:"deleteModal"},w={class:"modal-dialog modal-dialog-centered"},k={class:"modal-content"},U=c(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Вы действительно хотите удалить изображение?"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Закрыть"})],-1)),C={class:"modal-body"},S=["src"],A={class:"modal-footer justify-content-start"},L=c(()=>e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть",-1)),E={class:"modal fade",id:"createModal"},V={class:"modal-dialog modal-dialog-centered"},R=c(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Добавление изображения"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Закрыть"})],-1)),B={class:"modal-body"},D=c(()=>e("div",{class:"modal-footer justify-content-start"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть"),e("button",{class:"btn btn-success","data-bs-dismiss":"modal"},"Добавить")],-1)),M=c(()=>e("div",{class:"title my-3 d-flex align-items-center gap-3"},[e("h1",null,"Управление фотогалереей"),e("span",{class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#createModal"},"Добавить фотографию")],-1)),x={class:"gallery"},F=["src"],G={class:"gallery-buttons d-flex gap-2"},j=["onClick"],z=["onClick"],H=["onClick"],N=["onClick","src"],O={key:0,class:"text-center"};function T(t,s,g,r,l,a){return i(),n(_,null,[e("div",P,[e("div",w,[e("div",k,[U,e("div",C,[e("img",{src:l.deleteSrc,class:"w-100 rounded-2",alt:"Фото"},null,8,S)]),e("div",A,[L,e("button",{onClick:s[0]||(s[0]=o=>a.deleteImage(l.deleteId,l.deleteIndex)),type:"button",class:"btn btn-danger","data-bs-dismiss":"modal"},"Удалить")])])])]),e("div",E,[e("div",V,[e("form",{class:"modal-content",onSubmit:s[2]||(s[2]=b((...o)=>a.create&&a.create(...o),["prevent"]))},[R,e("div",B,[e("input",{onChange:s[1]||(s[1]=(...o)=>a.handlePhotoUpload&&a.handlePhotoUpload(...o)),ref:"files",class:"form-control",type:"file",id:"photo"},null,544)]),D],32)])]),M,e("div",x,[(i(!0),n(_,null,f(l.images,(o,d)=>(i(),n("div",{class:"gallery-item",key:d},[e("img",{class:"gallery-image",src:"/storage/"+o.src,alt:"Фото"},null,8,F),e("div",G,[e("span",{class:"badge bg-primary",onClick:h=>a.openImage(d)},"Смотреть",8,j),e("span",{class:"badge bg-danger",onClick:h=>a.openDeleteImage(d),"data-bs-toggle":"modal","data-bs-target":"#deleteModal"},"Удалить",8,z)]),o.show?(i(),n("div",{key:0,onClick:h=>a.closeImage(d),class:"overlay"},[e("img",{onClick:h=>a.closeImage(d),src:"/storage/"+o.src,alt:"Фото"},null,8,N)],8,H)):p("",!0)]))),128))]),l.loading?(i(),n("div",O,"Loading...")):p("",!0)],64)}const q=u(I,[["render",T],["__scopeId","data-v-f1cfa486"]]);export{q as default};
