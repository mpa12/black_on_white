import{_ as C,U as l,f as p,r as _,o as m,c,a as s,t as h,i as d,k as y,l as b,m as k,F as g,g as v,h as A,p as R,d as x,b as f}from"./app-b67aaecc.js";import{c as D}from"./ChangeDate-db5be761.js";import{A as I}from"./ArticleService-885db772.js";import"./_commonjsHelpers-87174ba5.js";const z={name:"Comment",props:["comment","comments"],data(){return{canComment:!1,canDeleteComment:!1,childComments:null,parentComments:[],errors:[],replying:!1,isDeleted:!1,body:null}},mounted(){this.getChildComment(),this.checkCanComment(),this.checkCanDeleteComment()},methods:{changeDate:D,checkCanComment(){this.canComment=l.isAuth()},checkCanDeleteComment(){this.canDeleteComment=this.comment.can_delete},getChildComment(){const t=n=>n.parent_id===this.comment.id;this.childComments=this.comments.filter(t)},showReplyForm(){this.replying=!0},hideReplyForm(){this.replying=!1},reply(){let t=new FormData;t.append("body",this.body),t.append("article_id",this.$route.params.id),t.append("parent_id",this.comment.id);const n="/api/comment",r={headers:{"Content-Type":"multipart/form-data",Authorization:l.getAuthorizationString()}};p.post(n,t,r).then(a=>{this.errors=[],this.body=null,this.childComments.push(a.data.success)}).catch(a=>{if(a.response.status!==422)return;this.errors=[];let e=JSON.parse(a.request.responseText).errors;for(const o in e)this.errors[o]=e[o][0]})},deleteComment(t){const n="/api/comment/"+t,r={_method:"delete"},a={headers:{"Content-Type":"multipart/form-data",Authorization:l.getAuthorizationString()}};p.post(n,r,a).then(()=>{this.isDeleted=!0}).catch(console.error)}}},S=t=>(R("data-v-e6e7b3ad"),t=t(),x(),t),F={key:0,class:"comment mt-2"},T={class:"d-flex gap-2 align-items-baseline"},N={class:"m-0"},V={class:"m-0"},B={class:"flex-grow-1"},H=S(()=>s("label",{class:"form-label"},"Ответ",-1)),M={class:"d-flex flex-column justify-content-between align-items-end"},U=S(()=>s("button",{class:"btn btn-dark"},"Отправить",-1));function L(t,n,r,a,e,o){const u=_("comment",!0);return m(),c(g,null,[e.isDeleted?d("",!0):(m(),c("section",F,[s("div",T,[s("h6",N,h(r.comment.user.name),1),s("time",null,h(o.changeDate(r.comment.created_at)),1)]),s("p",V,h(r.comment.body),1),e.canComment?(m(),c("button",{key:0,type:"button",class:"reply-button",onClick:n[0]||(n[0]=(...i)=>o.showReplyForm&&o.showReplyForm(...i))})):d("",!0),e.canDeleteComment?(m(),c("button",{key:1,type:"button",class:"delete-button",onClick:n[1]||(n[1]=i=>o.deleteComment(r.comment.id))})):d("",!0),e.replying?(m(),c("form",{key:2,class:"d-flex gap-2",onSubmit:n[4]||(n[4]=y((...i)=>o.reply&&o.reply(...i),["prevent"]))},[s("div",B,[H,b(s("input",{"onUpdate:modelValue":n[2]||(n[2]=i=>e.body=i),type:"text",class:"form-control"},null,512),[[k,e.body]])]),s("div",M,[s("button",{class:"reply-cancel",type:"button",onClick:n[3]||(n[3]=(...i)=>o.hideReplyForm&&o.hideReplyForm(...i))},"отмена"),U])],32)):d("",!0)])),s("div",null,[e.childComments?(m(!0),c(g,{key:0},v(e.childComments,i=>(m(),A(u,{comment:i,comments:r.comments},null,8,["comment","comments"]))),256)):d("",!0)])],64)}const P=C(z,[["render",L],["__scopeId","data-v-e6e7b3ad"]]);const q={name:"Comments",components:{Comment:P},props:["article_id"],data(){return{canComment:!1,hasComments:!1,comments:[],parentComments:[],body:null,errors:[]}},mounted(){this.loadComments()},methods:{checkCanComment(){this.canComment=l.isAuth()},checkHasComments(){this.hasComments=!!this.comments},getParentComments(){this.parentComments=this.comments.filter(t=>t.parent_id===null)},loadComments(){const t=`/api/comment/${this.article_id}`,n={headers:{Authorization:l.getAuthorizationString()}};p.get(t,n).then(r=>{this.comments=r.data.data,this.checkCanComment(),this.checkHasComments(),this.getParentComments()})},createComment(){let t=new FormData;t.append("body",this.body),t.append("article_id",this.article_id);const n="/api/comment",r={headers:{"Content-Type":"multipart/form-data",Authorization:l.getAuthorizationString()}};p.post(n,t,r).then(a=>{this.errors=[],this.body=null,this.comments.push(a.data.success),this.getParentComments()}).catch(a=>{if(a.response.status!==422)return;this.errors=[];let e=JSON.parse(a.request.responseText).errors;for(const o in e)this.errors[o]=e[o][0]})}}},w=t=>(R("data-v-6e171bc3"),t=t(),x(),t),J={key:0,class:"comments-section mt-3"},O={class:"flex-grow-1"},j=w(()=>s("label",{class:"form-label"},"Комментарий",-1)),E=w(()=>s("button",{class:"btn btn-dark"},"Отправить",-1)),G={key:1,class:"alert alert-light text-center"};function $(t,n,r,a,e,o){const u=_("comment");return e.canComment||e.hasComments?(m(),c("section",J,[e.canComment?(m(),c("form",{key:0,class:"d-flex align-items-end gap-2",onSubmit:n[1]||(n[1]=y((...i)=>o.createComment&&o.createComment(...i),["prevent"]))},[s("div",O,[j,b(s("input",{type:"text",class:"form-control","onUpdate:modelValue":n[0]||(n[0]=i=>e.body=i)},null,512),[[k,e.body]])]),E],32)):d("",!0),e.hasComments?d("",!0):(m(),c("p",G,"Нет комментариев")),(m(!0),c(g,null,v(e.parentComments,i=>(m(),A(u,{comment:i,comments:e.comments},null,8,["comment","comments"]))),256))])):d("",!0)}const K=C(q,[["render",$],["__scopeId","data-v-6e171bc3"]]);const Q={name:"ArticleRating",props:["articleId"],data(){return{rating:0,isRated:!1}},mounted(){this.getRating(this.articleId)},methods:{getRating(t){p.get(`/api/rating/${t}`,{headers:{Authorization:l.getAuthorizationString()}}).then(this.setRating).catch(console.error)},getImageSrc(t){return t?"/images/heart-fill.svg":"/images/heart.svg"},getImageAlt(t){return t?"Понравилось":"Лайкнуть"},updateRating(t){if(l.isGuest())return;this.rating+=this.isRated?-1:1,this.isRated=!this.isRated;let n=new FormData;n.append("create_rating",this.isRated?1:0),n.append("article_id",t),p.post("/api/rating",n,{headers:{"Content-Type":"multipart/form-data",Authorization:l.getAuthorizationString()}}).then(this.setRating).catch(console.error)},setRating(t){this.rating=t.data.rating,this.isRated=t.data.isRated}}},W={class:"w-100 section mt-3"},X=["src","alt"];function Y(t,n,r,a,e,o){return m(),c("section",W,[s("span",{role:"button",class:"me-2",onClick:n[0]||(n[0]=u=>o.updateRating(this.articleId))},[s("img",{src:o.getImageSrc(e.isRated),alt:o.getImageAlt(e.isRated)},null,8,X)]),s("span",null,h(e.rating),1)])}const Z=C(Q,[["render",Y],["__scopeId","data-v-7616f0a0"]]);const tt={name:"Article",components:{ArticleRating:Z,Comments:K},data(){return{article:[]}},mounted(){this.loadArticle()},methods:{changeDate:D,async loadArticle(){this.article=await I.show(this.$route.params.id)}}},et={class:"article-main"},nt={class:"mb-2"},st={class:"fw-lighter"},ot=s("br",null,null,-1),it={class:"mt-2"},rt=["src","alt"],at=["innerHTML"];function mt(t,n,r,a,e,o){const u=_("article-rating"),i=_("comments");return m(),c(g,null,[s("section",et,[s("h3",nt,h(e.article.title),1),s("span",st,h(o.changeDate(e.article.created_at)),1),ot,s("p",it,h(e.article.description),1),s("img",{src:"/storage/"+e.article.photo,alt:e.article.title,class:"my-2 mx-auto d-block article-main-img"},null,8,rt),s("section",{class:"mt-2 content",innerHTML:e.article.text},null,8,at)]),f(u,{"article-id":t.$route.params.id},null,8,["article-id"]),f(i,{article_id:t.$route.params.id},null,8,["article_id"])],64)}const ut=C(tt,[["render",mt]]);export{ut as default};
