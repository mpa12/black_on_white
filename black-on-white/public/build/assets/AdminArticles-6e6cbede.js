import{_ as k,f as g,U as w,r as A,o as d,c,a as t,e as h,t as o,b as p,F as m,g as x,w as y,s as b,k as f,i as C,p as I,d as V}from"./app-f65f30b7.js";import{A as D}from"./ArticleSearch-290175f4.js";import{c as F}from"./ChangeDate-db5be761.js";import"./_commonjsHelpers-87174ba5.js";const M={name:"AdminArticles",components:{ArticleSearch:D},data(){return{articles:[],currentPage:1,loading:!1,totalPages:null,selectedFilters:[],text:"",deleteArticleInfo:[]}},computed:{pages(){const a=[],{currentPage:u,totalPages:_}=this;let l=Math.max(u-Math.floor(5/2),1),i=Math.min(l+5-1,_);i-l<5-1&&(l=Math.max(i-5+1,1));for(let r=l;r<=i;r++)a.push(r);return a}},mounted(){this.loadArticles(),window.addEventListener("search",function(s){this.selectedFilters=[...s.detail.selectedFilters],this.text=s.detail.text,this.articles=[],this.page=1,this.loadArticles()}.bind(this))},methods:{changeDate:F,loadArticles(){this.loading=!0;let s={page:this.currentPage};this.text!==""&&(s.text=this.text),this.selectedFilters.length>0&&(s.article_type=this.selectedFilters.join(",")),g.get("/api/article",{params:s}).then(a=>{this.articles=a.data.data,this.totalPages=a.data.meta.last_page,this.loading=!1})},prevPage(){this.currentPage>1&&(this.currentPage--,this.loadArticles())},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadArticles())},goToPage(s){this.currentPage!==s&&(this.currentPage=s,this.loadArticles())},loadDeleteArticle(s){g.get("/api/article/"+s).then(a=>{this.deleteArticleInfo=a.data.data})},deleteArticle(s){const a="/api/article/"+s,u={_method:"delete"},_={headers:{Authorization:w.getAuthorizationString()}};g.post(a,u,_).then(this.loadArticles).catch(console.error)}}},n=s=>(I("data-v-ccb46f28"),s=s(),V(),s),S={class:"modal fade",id:"deleteModal"},N={class:"modal-dialog modal-dialog-centered"},z={class:"modal-content"},B={class:"modal-header"},L={class:"modal-title fs-5"},T=n(()=>t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1)),j={class:"modal-body"},E={class:"modal-footer justify-content-start"},U=n(()=>t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Отмена",-1)),q=n(()=>t("div",{class:"title my-3"},[t("h1",null,"Управление новостями")],-1)),G={class:"table-wrapper"},H={class:"table table-hover"},J=n(()=>t("thead",null,[t("tr",null,[t("th",null,"№"),t("th",null,"ID"),t("th",null,"Заголовок"),t("th",null,"Описание"),t("th",null,"Тип"),t("th",null,"Создано"),t("th",null,"Обновлено"),t("th")])],-1)),K=["title"],O=["title"],Q={class:"dropdown"},R=n(()=>t("span",{type:"button","data-bs-toggle":"dropdown"},[t("img",{src:"/images/three-dots-vertical.svg",alt:"three-dots-vertical",type:"button","data-toggle":"dropdown"})],-1)),W={class:"dropdown-menu dropdown-menu-end"},X=["onClick"],Y={class:"pagination"},Z=n(()=>t("span",{"aria-hidden":"true"},"«",-1)),$=[Z],tt=["onClick"],et=n(()=>t("span",{"aria-hidden":"true"},"»",-1)),st=[et],at={key:0,class:"text-center"};function lt(s,a,u,_,l,i){const r=A("article-search"),v=A("router-link");return d(),c(m,null,[t("div",S,[t("div",N,[t("div",z,[t("div",B,[t("h1",L,[h("Удаление новости "),t("span",null,"«"+o(l.deleteArticleInfo.title)+"»",1)]),T]),t("div",j,[h(" Вы уверенны, что хотите удалить новость "),t("span",null,"«"+o(l.deleteArticleInfo.title)+"»",1),h("? ")]),t("div",E,[U,t("button",{type:"button",class:"btn btn-danger",onClick:a[0]||(a[0]=e=>i.deleteArticle(l.deleteArticleInfo.id)),"data-bs-dismiss":"modal"},"Удалить")])])])]),q,p(r,{class:"mb-3"}),t("div",G,[t("table",H,[J,t("tbody",null,[(d(!0),c(m,null,x(l.articles,(e,P)=>(d(),c("tr",null,[t("th",null,o(P+1),1),t("td",null,o(e.id),1),t("td",{class:"text-truncate user-select-none",title:e.title},[p(v,{to:"/article/"+e.id,class:"text-decoration-none"},{default:y(()=>[h(o(e.title),1)]),_:2},1032,["to"])],8,K),t("td",{class:"text-truncate",title:e.description},o(e.description),9,O),t("td",null,o(e.article_type.title),1),t("td",null,o(i.changeDate(e.created_at)),1),t("td",null,o(i.changeDate(e.updated_at)),1),t("td",null,[t("div",Q,[R,t("ul",W,[t("li",null,[p(v,{class:"dropdown-item",to:"/admin/articles/update/"+e.id},{default:y(()=>[h("Редактировать")]),_:2},1032,["to"])]),t("li",null,[t("span",{onClick:it=>i.loadDeleteArticle(e.id),class:"dropdown-item",type:"button","data-bs-toggle":"modal","data-bs-target":"#deleteModal"}," Удалить ",8,X)])])])])]))),256))])]),t("nav",null,[t("ul",Y,[t("li",{class:b(["page-item",{disabled:l.currentPage===1}])},[t("span",{class:"page-link","aria-label":"Previous",onClick:a[1]||(a[1]=f((...e)=>i.prevPage&&i.prevPage(...e),["prevent"]))},$)],2),(d(!0),c(m,null,x(i.pages,e=>(d(),c("li",{class:b(["page-item",{active:e===l.currentPage}]),key:e},[t("span",{class:"page-link",onClick:f(P=>i.goToPage(e),["prevent"])},o(e),9,tt)],2))),128)),t("li",{class:b(["page-item",{disabled:l.currentPage===l.totalPages}])},[t("span",{class:"page-link","aria-label":"Next",onClick:a[2]||(a[2]=f((...e)=>i.nextPage&&i.nextPage(...e),["prevent"]))},st)],2)])])]),l.loading?(d(),c("div",at,"Loading...")):C("",!0)],64)}const rt=k(M,[["render",lt],["__scopeId","data-v-ccb46f28"]]);export{rt as default};
