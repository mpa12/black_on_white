import{_ as b,f as g,U as u,o as c,c as r,a as t,k as f,F as _,g as y,i as p,p as v,d as I}from"./app-f65f30b7.js";const w={name:"AdminPhotoGallery",data(){return{images:[],page:1,totalPages:null,loading:!0,deleteSrc:null,deleteId:null,deleteIndex:null,photo:null}},mounted(){this.loadImages(),window.addEventListener("scroll",this.handleScroll)},destroyed(){window.removeEventListener("scroll",this.handleScroll)},methods:{openImage(e){this.images[e].show=!0,document.body.style.overflow="hidden"},closeImage(e){this.images[e].show=!1,document.body.style.overflow="auto"},loadImages(){this.loading=!0;let e={page:this.page};g.get("/api/photo-gallery",{params:e}).then(s=>{let d=s.data.data.map(i=>({src:i.photo,show:!1,id:i.id}));this.images=[...this.images,...d],this.totalPages=s.data.meta.last_page,this.loading=!1})},handleScroll(){if(!this.loading&&window.pageYOffset+window.innerHeight+200>=document.body.offsetHeight){if(!(this.page<this.totalPages))return;this.page++,this.loadImages()}},openDeleteImage(e){this.deleteSrc=this.images[e].src,this.deleteId=this.images[e].id,this.deleteIndex=e},deleteImage(e,s){const d=`/api/photo-gallery/${e}`,i={_method:"delete"},l={headers:{Authorization:u.getAuthorizationString()}};g.post(d,i,l).then(()=>{this.images.splice(s,1)}).catch(console.error)},create(){let e=new FormData;e.append("photo",this.photo);const s="/api/photo-gallery",d={headers:{"Content-Type":"multipart/form-data",Authorization:u.getAuthorizationString()}};g.post(s,e,d).then(()=>{this.photo=null,this.images=[],this.page=1,this.totalPages=null,this.loading=!0,this.loadImages()}).catch(console.error)},handlePhotoUpload(){this.photo=this.$refs.files.files[0]}}},h=e=>(v("data-v-119b96c6"),e=e(),I(),e),k={class:"modal fade",id:"deleteModal"},C={class:"modal-dialog modal-dialog-centered"},S={class:"modal-content"},P=h(()=>t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Вы действительно хотите удалить изображение?"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Закрыть"})],-1)),A={class:"modal-body"},D=["src"],M={class:"modal-footer justify-content-start"},U=h(()=>t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть",-1)),x={class:"modal fade",id:"createModal"},z={class:"modal-dialog modal-dialog-centered"},L=h(()=>t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Добавление изображения"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Закрыть"})],-1)),B={class:"modal-body"},E=h(()=>t("div",{class:"modal-footer justify-content-start"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть"),t("button",{class:"btn btn-success","data-bs-dismiss":"modal"},"Добавить")],-1)),F=h(()=>t("div",{class:"title my-3 d-flex align-items-center gap-3"},[t("h1",null,"Управление фотогалереей"),t("span",{class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#createModal"},"Добавить фотографию")],-1)),G={class:"gallery"},j=["src"],H={class:"gallery-buttons d-flex gap-2"},N=["onClick"],V=["onClick"],O=["onClick"],T=["onClick","src"],Y={key:0,class:"text-center"};function q(e,s,d,i,l,a){return c(),r(_,null,[t("div",k,[t("div",C,[t("div",S,[P,t("div",A,[t("img",{src:"/storage/"+l.deleteSrc,class:"w-100 rounded-2",alt:"Фото"},null,8,D)]),t("div",M,[U,t("button",{onClick:s[0]||(s[0]=o=>a.deleteImage(l.deleteId,l.deleteIndex)),type:"button",class:"btn btn-danger","data-bs-dismiss":"modal"},"Удалить")])])])]),t("div",x,[t("div",z,[t("form",{class:"modal-content",onSubmit:s[2]||(s[2]=f((...o)=>a.create&&a.create(...o),["prevent"]))},[L,t("div",B,[t("input",{onChange:s[1]||(s[1]=(...o)=>a.handlePhotoUpload&&a.handlePhotoUpload(...o)),ref:"files",class:"form-control",type:"file",id:"photo"},null,544)]),E],32)])]),F,t("div",G,[(c(!0),r(_,null,y(l.images,(o,n)=>(c(),r("div",{class:"gallery-item",key:n},[t("img",{class:"gallery-image",src:"/storage/"+o.src,alt:"Фото"},null,8,j),t("div",H,[t("span",{class:"badge bg-primary",onClick:m=>a.openImage(n)},"Смотреть",8,N),t("span",{class:"badge bg-danger",onClick:m=>a.openDeleteImage(n),"data-bs-toggle":"modal","data-bs-target":"#deleteModal"},"Удалить",8,V)]),o.show?(c(),r("div",{key:0,onClick:m=>a.closeImage(n),class:"overlay"},[t("img",{onClick:m=>a.closeImage(n),src:"/storage/"+o.src,alt:"Фото"},null,8,T)],8,O)):p("",!0)]))),128))]),l.loading?(c(),r("div",Y,"Loading...")):p("",!0)],64)}const K=b(w,[["render",q],["__scopeId","data-v-119b96c6"]]);export{K as default};
